<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>Gjun Rent | ç·šä¸Šç§Ÿè»Š</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            padding-top: 70px;
            /* çµ¦å›ºå®š Navbar ç•™ç©ºé–“ */
        }

        .car-card img {
            height: 250px;
            object-fit: cover;
        }
    </style>
</head>

<body>

    <!-- ğŸ”¹ å°è¦½åˆ— Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">GOTO Rent</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="http://127.0.0.1:5500/test/carrentalDemo.html">é¦–é </a>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm ms-lg-3" onclick="location.href='orders.html'">
                            æˆ‘çš„è¨‚å–®
                        </button>
                    </li>

                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm ms-lg-3" data-bs-toggle="modal"
                            data-bs-target="#loginModal">
                            æœƒå“¡ç™»å…¥
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ğŸ”¹ æœå°‹æ¢ä»¶å€å¡Š -->
    <header class="bg-light border-bottom">
        <div class="container py-4">
            <h1 class="h4 mb-3">æœå°‹ç§Ÿè»Š</h1>
            <form id="search-form" class="row gy-2 gx-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label">å–è»Šåˆ†åº—</label>
                    <select class="form-select" id="pickupLocation">
                        <option value="">ä¸é™</option>
                        <option value="taipei">å°åŒ—</option>
                        <option value="HsinChu">æ–°ç«¹</option>
                        <option value="Taichung">å°ä¸­</option>
                        <option value="kaoSiung">é«˜é›„</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">å–è»Šæ—¥æœŸ</label>
                    <input type="date" class="form-control" id="pickupDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">é‚„è»Šæ—¥æœŸ</label>
                    <input type="date" class="form-control" id="returnDate">
                </div>
                <div class="col-md-2">
                    <label class="form-label">è»Šå‹</label>
                    <select class="form-select" id="carType">
                        <option value="">ä¸é™</option>
                        <option value="eco">ç¶“æ¿Ÿå°å‹è»Š</option>
                        <option value="sedan">ä¸­å‹æˆ¿è»Š</option>
                        <option value="suv">SUV</option>
                        <option value="van">ä¸ƒäººåº§</option>
                    </select>
                </div>
                <div class="col-md-3 text-md-end">
                    <button type="button" id="searchBtn" class="btn btn-primary w-100 w-md-auto">
                        æœå°‹å¯ç§Ÿè»Šè¼›
                    </button>
                </div>
            </form>
        </div>
    </header>

    <!-- ğŸ”¹ ä¸»å…§å®¹å€ï¼šè»Šè¼›åˆ—è¡¨ + è¨‚å–®æ‘˜è¦ -->
    <main class="container my-4">
        <div class="row">
            <!-- è»Šè¼›åˆ—è¡¨ -->
            <div class="col-lg-8">
                <h2 class="h5 mb-3">å¯ç§Ÿè»Šè¼›</h2>
                <div id="car-list" class="row g-3">
                    <!-- é€™è£¡ç”¨ JS render è»Šå¡ç‰‡ -->
                </div>
            </div>

            <!-- è¨‚å–®æ‘˜è¦ -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        è¨‚å–®æ‘˜è¦
                    </div>
                    <div class="card-body" id="booking-summary">
                        <p class="text-muted mb-1">å°šæœªé¸æ“‡è»Šè¼›</p>
                        <small class="text-muted">è«‹å¾å·¦å´åˆ—è¡¨é¸æ“‡ä¸€å°è»Šã€‚</small>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ğŸ”¹ é ç´„ Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ç¢ºèªé ç´„</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="modal-car-name" class="fw-bold"></p>
                    <p id="modal-car-info" class="mb-2"></p>
                    <p id="modal-date-info" class="text-muted small"></p>

                    <hr>
                    <div class="mb-3">
                        <label class="form-label">ç§Ÿè»Šäººå§“å</label>
                        <input type="text" class="form-control" id="customerName" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">è¯çµ¡é›»è©±</label>
                        <input type="tel" class="form-control" id="customerPhone" placeholder="09xx-xxx-xxx">
                    </div>
                    <div class="mb-3 form-check">
                        <label class="form-check-label">åŠ è³¼å¬°å…’è»Š</label>
                        <input type="checkbox" name="babycart" class="form-check-input" id="addItem_1">

                    </div>

                    <div class="mb-3 form-check">
                        <label class="form-check-label">åŠ è³¼å®‰å¿ƒè»Šéšª</label>
                        <input type="checkbox" name="insurance" class="form-check-input" id="addItem_2">

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" id="confirmBookingBtn">
                        é€å‡ºé ç´„ï¼ˆå‡ï¼‰
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æœƒå“¡ç™»å…¥ Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- æ¨™é ­ -->
                <div class="modal-header">
                    <h5 class="modal-title">æœƒå“¡ç™»å…¥</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- å…§å®¹ -->
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="example@email.com"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">å¯†ç¢¼</label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">
                                    è¨˜ä½æˆ‘
                                </label>
                            </div>
                            <a href="#" class="small">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
                        </div>

                        <div class="alert alert-danger py-2 px-3 d-none" id="loginError">
                            ç™»å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªå¸³è™Ÿæˆ–å¯†ç¢¼ã€‚
                        </div>
                    </form>
                </div>

                <!-- æŒ‰éˆ•åˆ— -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                    <button type="button" class="btn btn-primary" id="loginSubmitBtn">
                        ç™»å…¥
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ğŸ”¹ é é¢è…³æœ¬ï¼šç›®å‰å…ˆç”¨å‡è³‡æ–™ï¼Œä¹‹å¾Œæ”¹æˆå‘¼å« RESTful API -->
    <script>

        // å‡ç™»å…¥ï¼šå¸³è™Ÿ test@example.com / å¯†ç¢¼ 123456
        document.getElementById("loginSubmitBtn").addEventListener("click", function () {
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value.trim();
            const errorBox = document.getElementById("loginError");

            if (!email || !password) {
                errorBox.classList.remove("d-none");
                errorBox.textContent = "è«‹è¼¸å…¥ Email å’Œå¯†ç¢¼ã€‚";
                return;
            }

            // ä¹‹å¾Œå¯æ”¹æˆå‘¼å«å¾Œç«¯ /api/login
            // ç¾åœ¨å…ˆå¯«æ­»åšç¤ºç¯„
            if (email === "test@example.com" && password === "123456") {
                errorBox.classList.add("d-none");
                alert("ç™»å…¥æˆåŠŸï¼ˆç›®å‰ç‚ºå‰ç«¯æ¸¬è©¦ç”¨ï¼‰");

                // TODO: å¯ä»¥åœ¨é€™è£¡æ›´æ–° Navbar é¡¯ç¤ºã€Œæ‚¨å¥½ï¼ŒXXXã€
                // é—œé–‰ modal
                const modalEl = document.getElementById("loginModal");
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
            } else {
                errorBox.classList.remove("d-none");
                errorBox.textContent = "ç™»å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªå¸³è™Ÿæˆ–å¯†ç¢¼ã€‚";
            }
        });

        // ä¹‹å¾Œæ¥å¾Œç«¯çš„æ™‚å€™ï¼Œå¤§æ¦‚æœƒé•·é€™æ¨£ï¼š
        /*
        fetch("/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: email,
                password: password
            })
        }).then(res => {
            if (!res.ok) throw new Error();
            return res.json();
        }).then(user => {
            // ç™»å…¥æˆåŠŸè™•ç†
        }).catch(err => {
            // é¡¯ç¤ºéŒ¯èª¤
        });
        */


        // âœ ä¹‹å¾Œå¯ä»¥æ”¹æˆå¾ /api/cars å–å¾—
        const sampleCars = [
            {
                id: 1,
                name: "Toyota Vios æˆ–åŒç´š",
                type: "eco",
                pricePerDay: 1200,
                seats: 5,
                luggage: 2,
                imageUrl: "./imgs/ToYoTa.jpeg"
            },
            {
                id: 2,
                name: "Honda Civic æˆ–åŒç´š",
                type: "sedan",
                pricePerDay: 1800,
                seats: 5,
                luggage: 3,
                imageUrl: "./imgs/Honda.jpeg"
            },
            {
                id: 3,
                name: "Toyota RAV4 æˆ–åŒç´š",
                type: "suv",
                pricePerDay: 2400,
                seats: 5,
                luggage: 4,
                imageUrl: "./imgs/Toyota RAV4.jpeg"
            },
            {
                id: 4,
                name: "Volkswagen T6 ä¹äººåº§",
                type: "van",
                pricePerDay: 3200,
                seats: 9,
                luggage: 5,
                imageUrl: "./imgs/Volkswagen T6.jpeg"
            }
        ];

        let selectedCar = null;

        // æ¸²æŸ“è»Šè¼›å¡ç‰‡
        function renderCars(cars) {
            const carList = document.getElementById("car-list");
            carList.innerHTML = "";

            if (!cars || cars.length === 0) {
                carList.innerHTML = '<p class="text-muted">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è»Šè¼›ã€‚</p>';
                return;
            }

            cars.forEach(car => {
                const col = document.createElement("div");
                col.className = "col-md-6";

                col.innerHTML = `
                <div class="card car-card h-100">
                    <img src="${car.imageUrl}" class="card-img-top" alt="${car.name}">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${car.name}</h5>
                        <p class="card-text mb-1">
                            åº§ä½ï¼š${car.seats} äºº ï½œ è¡Œæï¼š${car.luggage} ä»¶
                        </p>
                        <p class="card-text fw-bold text-primary mb-2">
                            NT$ ${car.pricePerDay} / æ—¥
                        </p>
                        <button class="btn btn-outline-primary mt-auto"
                                onclick="openBooking(${car.id})">
                            ç«‹å³é ç´„
                        </button>
                    </div>
                </div>
            `;
                carList.appendChild(col);
            });
        }

        // é–‹å•Ÿé ç´„è¦–çª—
        function openBooking(carId) {
            selectedCar = sampleCars.find(c => c.id === carId);
            if (!selectedCar) return;

            // æ›´æ–° Modal å…§å®¹
            document.getElementById("modal-car-name").innerText = selectedCar.name;
            document.getElementById("modal-car-info").innerText =
                `NT$ ${selectedCar.pricePerDay} / æ—¥ï¼Œ${selectedCar.seats} äººåº§ï¼Œè¡Œæ ${selectedCar.luggage} ä»¶`;

            const pickup = document.getElementById("pickupDate").value || "(æœªé¸å–å–è»Šæ—¥æœŸ)";
            const ret = document.getElementById("returnDate").value || "(æœªé¸å–é‚„è»Šæ—¥æœŸ)";
            document.getElementById("modal-date-info").innerText =
                `ç§ŸæœŸï¼š${pickup}  ~  ${ret}`;

            // æ›´æ–°å³å´æ‘˜è¦
            const summary = document.getElementById("booking-summary");
            summary.innerHTML = `
            <p class="mb-1 fw-bold">${selectedCar.name}</p>
            <p class="mb-1 text-primary">NT$ ${selectedCar.pricePerDay} / æ—¥</p>
            <p class="small text-muted mb-0">å–è»Šæ—¥æœŸï¼š${pickup}</p>
            <p class="small text-muted">é‚„è»Šæ—¥æœŸï¼š${ret}</p>
        `;

            const modal = new bootstrap.Modal(document.getElementById("bookingModal"));
            modal.show();
        }

        // ç›£è½æœå°‹æŒ‰éˆ•ï¼ˆç›®å‰åªåšå‰ç«¯ç¯©é¸ï¼‰
        document.getElementById("searchBtn").addEventListener("click", function () {
            const type = document.getElementById("carType").value;

            let filtered = sampleCars;
            if (type) {
                filtered = sampleCars.filter(c => c.type === type);
            }

            // âœ ä¹‹å¾Œé€™è£¡å¯æ”¹æˆå‘¼å«å¾Œç«¯ï¼Œä¾‹å¦‚ï¼š
            //   fetch(`/api/cars?type=${type}&pickupDate=...`)
            renderCars(filtered);
        });

        // å‡çš„é ç´„é€å‡ºï¼ˆä¹‹å¾Œæ”¹æˆå‘¼å« POST /api/bookingsï¼‰
        document.getElementById("confirmBookingBtn").addEventListener("click", function () {
            const name = document.getElementById("customerName").value.trim();
            const phone = document.getElementById("customerPhone").value.trim();

            if (!name || !phone) {
                alert("è«‹è¼¸å…¥å§“åèˆ‡é›»è©±");
                return;
            }

            // âœ æœªä¾†ä½ å¯ä»¥åœ¨é€™è£¡å‘¼å«å¾Œç«¯ APIï¼Œä¾‹å¦‚ï¼š
            // fetch('/api/bookings', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({
            //         carId: selectedCar.id,
            //         customerName: name,
            //         customerPhone: phone,
            //         pickupDate: document.getElementById("pickupDate").value,
            //         returnDate: document.getElementById("returnDate").value
            //     })
            // }).then(...)

            alert("ç›®å‰æ˜¯å‰ç«¯å‡é ç´„ï¼Œä¹‹å¾Œå¯ä»¥æ¥ä¸Š RESTful å¾Œç«¯ã€‚");

            const modalEl = document.getElementById("bookingModal");
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
        });

        // é é¢è¼‰å…¥æ™‚å…ˆé¡¯ç¤ºå…¨éƒ¨è»Šè¼›
        document.addEventListener("DOMContentLoaded", function () {
            renderCars(sampleCars);
        });
    </script>

</body>

</html>